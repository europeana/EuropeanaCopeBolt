{% apply spaceless %}
{% set html = oembed
    |preg_replace('/width="\\d+"/', 'width="100%"')
    |preg_replace('/(src="[^"]+)/', '$1?width='~width)
%}

{% if setheight|default %}
    {% set html = html
        |preg_replace('/height="\\d+"/', 'height="'~height~'"')
    %}
{% endif %}

{{ html|raw }}

{% endapply %}
